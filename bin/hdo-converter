#!/usr/bin/env ruby

$LOAD_PATH.unshift File.expand_path("../../lib", __FILE__)
require 'hdo/storting_importer'
require 'optparse'

importer = Hdo::StortingImporter::Importer.new

OptionParser.new do |opt|
  valid_commands = (Hdo::StortingImporter::Importer::FILES.keys + Hdo::StortingImporter::Importer::CUSTOM_COMMANDS).join('|')
  opt.banner = "Usage: #{$0} <#{valid_commands}> [options]"

  opt.on("--help", "You're looking at it.") { puts opt; exit; }
  opt.on("--only-print", "Don't run import, only print generated XML.") { importer.only_print = true }
  opt.on("--except WHAT", 'Ignore this comma separated list of entities from import.') { |s| importer.ignore = s.split(",").map(&:strip).map(&:to_sym) }
  opt.on("--app APP_ROOT", 'Path to clone of git://github.com/holderdeord/hdo-site.git') { |path| importer.app_root = path }
  opt.on("--socks PROXY", 'host:port for SOCKS proxy') do |proxy|
    require 'socksify'
    host, port = proxy.split ":"
    TCPSocket.socks_server = host
    TCPSocket.socks_port = Integer(port)
  end
end.parse!(ARGV)

cmd = ARGV.shift
if cmd && cmd != "all"
  importer.import cmd.to_sym
else
  importer.import_all
end


